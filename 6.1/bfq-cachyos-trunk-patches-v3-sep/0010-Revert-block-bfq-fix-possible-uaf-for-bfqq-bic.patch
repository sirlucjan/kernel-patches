From 1fb4a22da4c66b628e37cbe7e90a03d8e9f0efeb Mon Sep 17 00:00:00 2001
From: Piotr Gorski <lucjan.lucjanov@gmail.com>
Date: Wed, 14 Dec 2022 17:41:57 +0100
Subject: [PATCH 10/15] Revert "block, bfq: fix possible uaf for 'bfqq->bic'"

This reverts commit 6ad56867ed0279997a656a60bab3ce1340023f7f.

Signed-off-by: Piotr Gorski <lucjan.lucjanov@gmail.com>
---
 block/bfq-iosched.c | 8 --------
 1 file changed, 8 deletions(-)

diff --git a/block/bfq-iosched.c b/block/bfq-iosched.c
index 5342d652b..43a8ff6c4 100644
--- a/block/bfq-iosched.c
+++ b/block/bfq-iosched.c
@@ -3043,14 +3043,6 @@ void bfq_release_process_ref(struct bfq_data *bfqd, struct bfq_queue *bfqq)
 
 	bfq_reassign_last_bfqq(bfqq, NULL);
 
-	/*
-	 * __bfq_bic_change_cgroup() just reset bic->bfqq so that a new bfqq
-	 * will be created to handle new io, while old bfqq will stay around
-	 * until all the requests are completed. It's unsafe to keep bfqq->bic
-	 * since they are not related anymore.
-	 */
-	if (bfqq_process_refs(bfqq) == 1)
-		bfqq->bic = NULL;
 	bfq_put_queue(bfqq);
 }
 
-- 
2.39.0.rc2.1.gbd5df96b79

