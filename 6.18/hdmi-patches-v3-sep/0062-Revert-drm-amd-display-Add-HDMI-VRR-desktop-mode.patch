From 6352240ab57c066b933bfac0342054d528bab4fa Mon Sep 17 00:00:00 2001
From: Peter Jung <admin@ptr1337.dev>
Date: Sat, 31 Jan 2026 13:14:34 +0100
Subject: [PATCH 062/100] Revert "drm/amd/display: Add HDMI VRR desktop mode"

This reverts commit 813ee5db9b75d52ccc8770a23493f4aa33f39341.
---
 drivers/gpu/drm/amd/amdgpu/amdgpu.h                 |  1 -
 drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c             | 13 -------------
 .../amd/display/modules/info_packet/info_packet.c   | 10 ++--------
 3 files changed, 2 insertions(+), 22 deletions(-)

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu.h b/drivers/gpu/drm/amd/amdgpu/amdgpu.h
index 818896155..188e9c585 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu.h
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu.h
@@ -274,7 +274,6 @@ extern int amdgpu_rebar;
 extern int amdgpu_wbrf;
 extern int amdgpu_user_queue;
 extern int amdgpu_allm_mode;
-extern bool amdgpu_hdmi_vrr_desktop_mode;
 
 #define AMDGPU_VM_MAX_NUM_CTX			4096
 #define AMDGPU_SG_THRESHOLD			(256*1024*1024)
diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c
index 22e034314..4c8ce5269 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_drv.c
@@ -247,7 +247,6 @@ int amdgpu_umsch_mm_fwlog;
 int amdgpu_rebar = -1; /* auto */
 int amdgpu_user_queue = -1;
 int amdgpu_allm_mode = 1;
-bool amdgpu_hdmi_vrr_desktop_mode = true;
 
 DECLARE_DYNDBG_CLASSMAP(drm_debug_classes, DD_CLASS_TYPE_DISJOINT_BITS, 0,
 			"DRM_UT_CORE",
@@ -1141,18 +1140,6 @@ module_param_named(user_queue, amdgpu_user_queue, int, 0444);
 MODULE_PARM_DESC(allm_mode, "Changes ALLM trigger mode (0 = disable, 1 = enable (default), 2 = force enable)");
 module_param_named(allm_mode, amdgpu_allm_mode, int, 0644);
 
-/**
- * DOC: hdmi_vrr_on_dekstop (bool)
- * Enables FreeSync behavior mimicking by keeping HDMI VRR signalling active in
- * fixed refresh rate conditions like normal desktop work/web browsing.
- * Possible values:
- *
- * -  false = HDMI VRR is only enabled if refresh rate is truly variable
- * -  true  = Mimics FreeSync behavior and keeps HDMI VRR always active
- */
-MODULE_PARM_DESC(hdmi_vrr_desktop_mode, "Changes HDMI VRR desktop mode (false = disable, true = enable (default))");
-module_param_named(hdmi_vrr_desktop_mode, amdgpu_hdmi_vrr_desktop_mode, bool, 0644);
-
 /* These devices are not supported by amdgpu.
  * They are supported by the mach64, r128, radeon drivers
  */
diff --git a/drivers/gpu/drm/amd/display/modules/info_packet/info_packet.c b/drivers/gpu/drm/amd/display/modules/info_packet/info_packet.c
index cf5a1ccb8..244297a8c 100644
--- a/drivers/gpu/drm/amd/display/modules/info_packet/info_packet.c
+++ b/drivers/gpu/drm/amd/display/modules/info_packet/info_packet.c
@@ -596,14 +596,8 @@ static void build_vtem_infopacket_data(const struct dc_stream_state *stream,
 	bool rb = false;
 
 	hdmi_vic_mode = is_hdmi_vic_mode(stream);
-
-	if (amdgpu_hdmi_vrr_desktop_mode) {
-		vrr_active = vrr->state != VRR_STATE_UNSUPPORTED &&
-			     vrr->state != VRR_STATE_DISABLED;
-	} else {
-		vrr_active = vrr->state == VRR_STATE_ACTIVE_VARIABLE ||
-			     vrr->state == VRR_STATE_ACTIVE_FIXED;
-	}
+	vrr_active = vrr->state == VRR_STATE_ACTIVE_VARIABLE ||
+		     vrr->state == VRR_STATE_ACTIVE_FIXED;
 
 	infopacket->sb[VTEM_MD0] = VTEM_M_CONST << VTEM_M_CONST_BIT;
 	infopacket->sb[VTEM_MD0] |= VTEM_FVA_FACTOR << VTEM_FVA_BIT;
-- 
2.52.0

