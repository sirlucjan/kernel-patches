From f3324a49ec07a40ac2569f32098ee6a822899edd Mon Sep 17 00:00:00 2001
From: Piotr Gorski <lucjan.lucjanov@gmail.com>
Date: Thu, 20 Oct 2022 18:46:50 +0200
Subject: [PATCH 28/36] Revert "elevator: remove redundant code in
 elv_unregister_queue()"

This reverts commit c47677f1afa495e13029d26fa81b69a91918c8cb.

Signed-off-by: Piotr Gorski <lucjan.lucjanov@gmail.com>
---
 block/elevator.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/block/elevator.c b/block/elevator.c
index 20e70fd3f..bd71f0fc4 100644
--- a/block/elevator.c
+++ b/block/elevator.c
@@ -524,6 +524,8 @@ void elv_unregister_queue(struct request_queue *q)
 	lockdep_assert_held(&q->sysfs_lock);
 
 	if (e && e->registered) {
+		struct elevator_queue *e = q->elevator;
+
 		kobject_uevent(&e->kobj, KOBJ_REMOVE);
 		kobject_del(&e->kobj);
 
-- 
2.38.1.473.ga0789512c5

